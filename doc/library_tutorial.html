<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.38.0">
    <meta name="project" content="Bardo v0.1.0">


    <title>Using Bardo as a Library — Bardo v0.1.0</title>

    <link rel="stylesheet" href="dist/html-elixir-J3PIVQVA.css" />

    <script defer src="dist/sidebar_items-1E8677F2.js"></script>
    <script defer src="docs_config.js"></script>
    <script defer src="dist/html-DPJLHKSM.js"></script>

  </head>
  <body>
    <script>(()=>{var t="ex_doc:settings",e="dark";var o="dark",s="light";var E="sidebar_state",n="closed";var r="sidebar_width";var a="sidebar-open";var i=new URLSearchParams(window.location.search),S=i.get("theme")||JSON.parse(localStorage.getItem(t)||"{}").theme;(S===o||S!==s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&document.body.classList.add(e);var d=sessionStorage.getItem(E),A=d!==n&&!window.matchMedia(`screen and (max-width: ${768}px)`).matches;document.body.classList.toggle(a,A);var c=sessionStorage.getItem(r);c&&document.body.style.setProperty("--sidebarWidth",`${c}px`);var p=/(Macintosh|iPhone|iPad|iPod)/.test(window.navigator.userAgent);document.documentElement.classList.toggle("apple-os",p);})();
</script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

      <div>
        <a href="https://github.com/hibernatus-hacker/bardo" class="sidebar-projectName" translate="no">
Bardo
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.1.0
        </div>
      </div>
    </div>
    <ul id="sidebar-list-nav" class="sidebar-list-nav" role="tablist" data-extras=""></ul>
  </div>
</nav>

<output role="status" id="toast"></output>

<main class="content page-extra" id="main" data-type="extras">
  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Bardo</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search" tabindex="-1">
            <i class="ri-search-2-line ri-lg" aria-hidden="true"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <div class="heading-with-actions top-heading">
    <h1>Using Bardo as a Library</h1>


      <a href="https://github.com/hibernatus-hacker/bardo/blob/main/docs/library_tutorial.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

  </div>


<p>This tutorial provides a step-by-step guide to using Bardo as a library in your own Elixir applications.</p><h2 id="1-setting-up-your-project" class="section-heading"><a href="#1-setting-up-your-project" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">1. Setting Up Your Project</span></h2><p>First, add Bardo as a dependency in your <code class="inline">mix.exs</code> file:</p><pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">deps</span><span class="w"> </span><span class="k" data-group-id="3875781894-1">do</span><span class="w">
  </span><span class="p" data-group-id="3875781894-2">[</span><span class="w">
    </span><span class="p" data-group-id="3875781894-3">{</span><span class="ss">:bardo</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.1.0&quot;</span><span class="p" data-group-id="3875781894-3">}</span><span class="w">
  </span><span class="p" data-group-id="3875781894-2">]</span><span class="w">
</span><span class="k" data-group-id="3875781894-1">end</span></code></pre><p>Then, fetch the dependencies:</p><pre><code class="makeup shell" translate="no"><span class="">mix deps.get
</span></code></pre><h2 id="2-creating-a-simple-xor-solver" class="section-heading"><a href="#2-creating-a-simple-xor-solver" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">2. Creating a Simple XOR Solver</span></h2><p>Let's create a simple application that uses Bardo to evolve a neural network that solves the XOR problem.</p><h3 id="2-1-define-your-application" class="section-heading"><a href="#2-1-define-your-application" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">2.1 Define Your Application</span></h3><p>Create a new module in your project:</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">MyApp.XorSolver</span><span class="w"> </span><span class="k" data-group-id="8872088672-1">do</span><span class="w">
  </span><span class="na">@moduledoc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  A module that uses Bardo to evolve a neural network solving the XOR problem.
  &quot;&quot;&quot;</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Evolves a neural network to solve XOR and returns the champion.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">run</span><span class="w"> </span><span class="k" data-group-id="8872088672-2">do</span><span class="w">
    </span><span class="c1"># Start Bardo subsystems</span><span class="w">
    </span><span class="nc">Bardo</span><span class="o">.</span><span class="n">start</span><span class="p" data-group-id="8872088672-3">(</span><span class="p" data-group-id="8872088672-3">)</span><span class="w">
    
    </span><span class="c1"># Create a unique experiment ID</span><span class="w">
    </span><span class="n">experiment_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;xor_</span><span class="si" data-group-id="8872088672-4">#{</span><span class="nc">:os</span><span class="o">.</span><span class="n">system_time</span><span class="p" data-group-id="8872088672-5">(</span><span class="ss">:millisecond</span><span class="p" data-group-id="8872088672-5">)</span><span class="si" data-group-id="8872088672-4">}</span><span class="s">&quot;</span><span class="w">
    
    </span><span class="c1"># Create the experiment</span><span class="w">
    </span><span class="p" data-group-id="8872088672-6">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="c">_pid</span><span class="p" data-group-id="8872088672-6">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.ExperimentManager</span><span class="o">.</span><span class="n">new_experiment</span><span class="p" data-group-id="8872088672-7">(</span><span class="n">experiment_id</span><span class="p" data-group-id="8872088672-7">)</span><span class="w">
    
    </span><span class="c1"># Configure the experiment</span><span class="w">
    </span><span class="ss">:ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.ExperimentManager</span><span class="o">.</span><span class="n">configure</span><span class="p" data-group-id="8872088672-8">(</span><span class="n">experiment_id</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8872088672-9">%{</span><span class="w">
      </span><span class="ss">population_size</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
      </span><span class="ss">max_generations</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
      </span><span class="ss">mutation_rate</span><span class="p">:</span><span class="w"> </span><span class="mf">0.3</span><span class="p">,</span><span class="w">
      </span><span class="ss">fitness_goal</span><span class="p">:</span><span class="w"> </span><span class="mf">3.9</span><span class="w">  </span><span class="c1"># Stop when we reach this fitness (max is 4.0)</span><span class="w">
    </span><span class="p" data-group-id="8872088672-9">}</span><span class="p" data-group-id="8872088672-8">)</span><span class="w">
    
    </span><span class="c1"># Start the evolution with our fitness function</span><span class="w">
    </span><span class="ss">:ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.ExperimentManager</span><span class="o">.</span><span class="n">start_evaluation</span><span class="p" data-group-id="8872088672-10">(</span><span class="n">experiment_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">evaluate_xor</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="8872088672-10">)</span><span class="w">
    
    </span><span class="c1"># Wait for the experiment to complete</span><span class="w">
    </span><span class="p" data-group-id="8872088672-11">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">experiment</span><span class="p" data-group-id="8872088672-11">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wait_for_completion</span><span class="p" data-group-id="8872088672-12">(</span><span class="n">experiment_id</span><span class="p" data-group-id="8872088672-12">)</span><span class="w">
    
    </span><span class="c1"># Get the best solution</span><span class="w">
    </span><span class="p" data-group-id="8872088672-13">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">champion</span><span class="p" data-group-id="8872088672-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.ExperimentManager</span><span class="o">.</span><span class="n">get_best_solution</span><span class="p" data-group-id="8872088672-14">(</span><span class="n">experiment_id</span><span class="p" data-group-id="8872088672-14">)</span><span class="w">
    
    </span><span class="c1"># Test the champion</span><span class="w">
    </span><span class="n">test_champion</span><span class="p" data-group-id="8872088672-15">(</span><span class="n">champion</span><span class="p" data-group-id="8872088672-15">)</span><span class="w">
    
    </span><span class="c1"># Return the champion genotype</span><span class="w">
    </span><span class="n">champion</span><span class="w">
  </span><span class="k" data-group-id="8872088672-2">end</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Evaluates a genotype on the XOR problem.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">evaluate_xor</span><span class="p" data-group-id="8872088672-16">(</span><span class="n">genotype</span><span class="p" data-group-id="8872088672-16">)</span><span class="w"> </span><span class="k" data-group-id="8872088672-17">do</span><span class="w">
    </span><span class="c1"># Convert genotype to neural network</span><span class="w">
    </span><span class="n">nn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.AgentManager.Cortex</span><span class="o">.</span><span class="n">from_genotype</span><span class="p" data-group-id="8872088672-18">(</span><span class="n">genotype</span><span class="p" data-group-id="8872088672-18">)</span><span class="w">
    
    </span><span class="c1"># The XOR inputs and expected outputs</span><span class="w">
    </span><span class="n">test_cases</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8872088672-19">[</span><span class="w">
      </span><span class="p" data-group-id="8872088672-20">{</span><span class="p" data-group-id="8872088672-21">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="8872088672-21">]</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="8872088672-20">}</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="8872088672-22">{</span><span class="p" data-group-id="8872088672-23">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p" data-group-id="8872088672-23">]</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p" data-group-id="8872088672-22">}</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="8872088672-24">{</span><span class="p" data-group-id="8872088672-25">[</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="8872088672-25">]</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p" data-group-id="8872088672-24">}</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="8872088672-26">{</span><span class="p" data-group-id="8872088672-27">[</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p" data-group-id="8872088672-27">]</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="8872088672-26">}</span><span class="w">
    </span><span class="p" data-group-id="8872088672-19">]</span><span class="w">
    
    </span><span class="c1"># Test each case and calculate fitness</span><span class="w">
    </span><span class="n">fitness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p" data-group-id="8872088672-28">(</span><span class="n">test_cases</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="8872088672-29">fn</span><span class="w"> </span><span class="p" data-group-id="8872088672-30">{</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="n">expected</span><span class="p" data-group-id="8872088672-30">}</span><span class="p">,</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="c1"># Get the actual output</span><span class="w">
      </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.AgentManager.Cortex</span><span class="o">.</span><span class="n">activate</span><span class="p" data-group-id="8872088672-31">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="n">inputs</span><span class="p" data-group-id="8872088672-31">)</span><span class="w">
      </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">List</span><span class="o">.</span><span class="n">first</span><span class="p" data-group-id="8872088672-32">(</span><span class="n">result</span><span class="p" data-group-id="8872088672-32">)</span><span class="w">
      
      </span><span class="c1"># Calculate fitness component (1.0 - error)</span><span class="w">
      </span><span class="c1"># The closer to expected, the higher the fitness</span><span class="w">
      </span><span class="n">fitness_component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">abs</span><span class="p" data-group-id="8872088672-33">(</span><span class="n">expected</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">output</span><span class="p" data-group-id="8872088672-33">)</span><span class="w">
      
      </span><span class="c1"># Add to total fitness</span><span class="w">
      </span><span class="n">acc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fitness_component</span><span class="w">
    </span><span class="k" data-group-id="8872088672-29">end</span><span class="p" data-group-id="8872088672-28">)</span><span class="w">
    
    </span><span class="n">fitness</span><span class="w">
  </span><span class="k" data-group-id="8872088672-17">end</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Tests a champion genotype on the XOR problem.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">test_champion</span><span class="p" data-group-id="8872088672-34">(</span><span class="n">genotype</span><span class="p" data-group-id="8872088672-34">)</span><span class="w"> </span><span class="k" data-group-id="8872088672-35">do</span><span class="w">
    </span><span class="n">nn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.AgentManager.Cortex</span><span class="o">.</span><span class="n">from_genotype</span><span class="p" data-group-id="8872088672-36">(</span><span class="n">genotype</span><span class="p" data-group-id="8872088672-36">)</span><span class="w">
    
    </span><span class="n">test_cases</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8872088672-37">[</span><span class="w">
      </span><span class="p" data-group-id="8872088672-38">{</span><span class="p" data-group-id="8872088672-39">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="8872088672-39">]</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="8872088672-38">}</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="8872088672-40">{</span><span class="p" data-group-id="8872088672-41">[</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p" data-group-id="8872088672-41">]</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p" data-group-id="8872088672-40">}</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="8872088672-42">{</span><span class="p" data-group-id="8872088672-43">[</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="8872088672-43">]</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p" data-group-id="8872088672-42">}</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="8872088672-44">{</span><span class="p" data-group-id="8872088672-45">[</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p" data-group-id="8872088672-45">]</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p" data-group-id="8872088672-44">}</span><span class="w">
    </span><span class="p" data-group-id="8872088672-37">]</span><span class="w">
    
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="8872088672-46">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Testing champion on XOR problem:&quot;</span><span class="p" data-group-id="8872088672-46">)</span><span class="w">
    </span><span class="nc">Enum</span><span class="o">.</span><span class="n">each</span><span class="p" data-group-id="8872088672-47">(</span><span class="n">test_cases</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="8872088672-48">fn</span><span class="w"> </span><span class="p" data-group-id="8872088672-49">{</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="n">expected</span><span class="p" data-group-id="8872088672-49">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.AgentManager.Cortex</span><span class="o">.</span><span class="n">activate</span><span class="p" data-group-id="8872088672-50">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="n">inputs</span><span class="p" data-group-id="8872088672-50">)</span><span class="w">
      </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">List</span><span class="o">.</span><span class="n">first</span><span class="p" data-group-id="8872088672-51">(</span><span class="n">result</span><span class="p" data-group-id="8872088672-51">)</span><span class="w">
      </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="8872088672-52">(</span><span class="s">&quot;Input: </span><span class="si" data-group-id="8872088672-53">#{</span><span class="n">inspect</span><span class="p" data-group-id="8872088672-54">(</span><span class="n">inputs</span><span class="p" data-group-id="8872088672-54">)</span><span class="si" data-group-id="8872088672-53">}</span><span class="s"> =&gt; Output: </span><span class="si" data-group-id="8872088672-55">#{</span><span class="nc">Float</span><span class="o">.</span><span class="n">round</span><span class="p" data-group-id="8872088672-56">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p" data-group-id="8872088672-56">)</span><span class="si" data-group-id="8872088672-55">}</span><span class="s"> (Expected: </span><span class="si" data-group-id="8872088672-57">#{</span><span class="n">expected</span><span class="si" data-group-id="8872088672-57">}</span><span class="s">)&quot;</span><span class="p" data-group-id="8872088672-52">)</span><span class="w">
    </span><span class="k" data-group-id="8872088672-48">end</span><span class="p" data-group-id="8872088672-47">)</span><span class="w">
  </span><span class="k" data-group-id="8872088672-35">end</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Waits for an experiment to complete.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">wait_for_completion</span><span class="p" data-group-id="8872088672-58">(</span><span class="n">experiment_id</span><span class="p">,</span><span class="w"> </span><span class="n">max_attempts</span><span class="w"> </span><span class="o">\\</span><span class="w"> </span><span class="mi">100</span><span class="p" data-group-id="8872088672-58">)</span><span class="w"> </span><span class="k" data-group-id="8872088672-59">do</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="n">max_attempts</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="8872088672-60">do</span><span class="w">
      </span><span class="p" data-group-id="8872088672-61">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="ss">:timeout</span><span class="p" data-group-id="8872088672-61">}</span><span class="w">
    </span><span class="k" data-group-id="8872088672-60">else</span><span class="w">
      </span><span class="k">case</span><span class="w"> </span><span class="nc">Bardo.ExperimentManager</span><span class="o">.</span><span class="n">status</span><span class="p" data-group-id="8872088672-62">(</span><span class="n">experiment_id</span><span class="p" data-group-id="8872088672-62">)</span><span class="w"> </span><span class="k" data-group-id="8872088672-63">do</span><span class="w">
        </span><span class="p" data-group-id="8872088672-64">{</span><span class="ss">:complete</span><span class="p">,</span><span class="w"> </span><span class="n">experiment</span><span class="p" data-group-id="8872088672-64">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
          </span><span class="p" data-group-id="8872088672-65">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">experiment</span><span class="p" data-group-id="8872088672-65">}</span><span class="w">
        
        </span><span class="p" data-group-id="8872088672-66">{</span><span class="ss">:in_progress</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p" data-group-id="8872088672-66">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
          </span><span class="nc">:timer</span><span class="o">.</span><span class="n">sleep</span><span class="p" data-group-id="8872088672-67">(</span><span class="mi">100</span><span class="p" data-group-id="8872088672-67">)</span><span class="w">
          </span><span class="n">wait_for_completion</span><span class="p" data-group-id="8872088672-68">(</span><span class="n">experiment_id</span><span class="p">,</span><span class="w"> </span><span class="n">max_attempts</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="8872088672-68">)</span><span class="w">
        
        </span><span class="n">other</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
          </span><span class="p" data-group-id="8872088672-69">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">other</span><span class="p" data-group-id="8872088672-69">}</span><span class="w">
      </span><span class="k" data-group-id="8872088672-63">end</span><span class="w">
    </span><span class="k" data-group-id="8872088672-60">end</span><span class="w">
  </span><span class="k" data-group-id="8872088672-59">end</span><span class="w">
</span><span class="k" data-group-id="8872088672-1">end</span></code></pre><h3 id="2-2-running-your-application" class="section-heading"><a href="#2-2-running-your-application" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">2.2 Running Your Application</span></h3><p>Now you can run your XOR solver from an IEx session:</p><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="nc">MyApp.XorSolver</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="5600421918-1">(</span><span class="p" data-group-id="5600421918-1">)</span></code></pre><h2 id="3-creating-a-custom-environment" class="section-heading"><a href="#3-creating-a-custom-environment" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">3. Creating a Custom Environment</span></h2><p>Let's create a more complex example where we define a custom environment with specific sensors and actuators.</p><h3 id="3-1-define-a-simple-grid-world-environment" class="section-heading"><a href="#3-1-define-a-simple-grid-world-environment" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">3.1 Define a Simple Grid World Environment</span></h3><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">MyApp.GridWorld</span><span class="w"> </span><span class="k" data-group-id="2406217187-1">do</span><span class="w">
  </span><span class="na">@moduledoc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  A simple 2D grid world where an agent must navigate to a goal.
  &quot;&quot;&quot;</span><span class="w">
  
  </span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">Morphology</span><span class="w"> </span><span class="k" data-group-id="2406217187-2">do</span><span class="w">
    </span><span class="na">@behaviour</span><span class="w"> </span><span class="nc">Bardo.Morphology</span><span class="w">
    
    </span><span class="na">@impl</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">sensor_spec</span><span class="w"> </span><span class="k" data-group-id="2406217187-3">do</span><span class="w">
      </span><span class="p" data-group-id="2406217187-4">[</span><span class="w">
        </span><span class="p" data-group-id="2406217187-5">%{</span><span class="w">
          </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="ss">:position_sensor</span><span class="p">,</span><span class="w">
          </span><span class="ss">fanout</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
          </span><span class="ss">vl</span><span class="p">:</span><span class="w"> </span><span class="ss">:float</span><span class="p">,</span><span class="w">
          </span><span class="ss">cortex_id</span><span class="p">:</span><span class="w"> </span><span class="no">nil</span><span class="p">,</span><span class="w">
          </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Position Sensor&quot;</span><span class="w">
        </span><span class="p" data-group-id="2406217187-5">}</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="2406217187-6">%{</span><span class="w">
          </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="ss">:goal_sensor</span><span class="p">,</span><span class="w">
          </span><span class="ss">fanout</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
          </span><span class="ss">vl</span><span class="p">:</span><span class="w"> </span><span class="ss">:float</span><span class="p">,</span><span class="w">
          </span><span class="ss">cortex_id</span><span class="p">:</span><span class="w"> </span><span class="no">nil</span><span class="p">,</span><span class="w">
          </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Goal Sensor&quot;</span><span class="w">
        </span><span class="p" data-group-id="2406217187-6">}</span><span class="w">
      </span><span class="p" data-group-id="2406217187-4">]</span><span class="w">
    </span><span class="k" data-group-id="2406217187-3">end</span><span class="w">
    
    </span><span class="na">@impl</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">actuator_spec</span><span class="w"> </span><span class="k" data-group-id="2406217187-7">do</span><span class="w">
      </span><span class="p" data-group-id="2406217187-8">[</span><span class="w">
        </span><span class="p" data-group-id="2406217187-9">%{</span><span class="w">
          </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="ss">:movement_actuator</span><span class="p">,</span><span class="w">
          </span><span class="ss">fanin</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">  </span><span class="c1"># Up, Down, Left, Right</span><span class="w">
          </span><span class="ss">vl</span><span class="p">:</span><span class="w"> </span><span class="ss">:float</span><span class="p">,</span><span class="w">
          </span><span class="ss">cortex_id</span><span class="p">:</span><span class="w"> </span><span class="no">nil</span><span class="p">,</span><span class="w">
          </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Movement Actuator&quot;</span><span class="w">
        </span><span class="p" data-group-id="2406217187-9">}</span><span class="w">
      </span><span class="p" data-group-id="2406217187-8">]</span><span class="w">
    </span><span class="k" data-group-id="2406217187-7">end</span><span class="w">
    
    </span><span class="na">@impl</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">hidden_layer_spec</span><span class="w"> </span><span class="k" data-group-id="2406217187-10">do</span><span class="w">
      </span><span class="p" data-group-id="2406217187-11">[</span><span class="w">
        </span><span class="p" data-group-id="2406217187-12">%{</span><span class="w">
          </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="ss">:hidden</span><span class="p">,</span><span class="w">
          </span><span class="ss">size</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
          </span><span class="ss">af</span><span class="p">:</span><span class="w"> </span><span class="ss">:tanh</span><span class="p">,</span><span class="w">
          </span><span class="ss">input_layer_ids</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2406217187-13">[</span><span class="ss">:position_sensor</span><span class="p">,</span><span class="w"> </span><span class="ss">:goal_sensor</span><span class="p" data-group-id="2406217187-13">]</span><span class="p">,</span><span class="w">
          </span><span class="ss">output_layer_ids</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2406217187-14">[</span><span class="ss">:movement_actuator</span><span class="p" data-group-id="2406217187-14">]</span><span class="w">
        </span><span class="p" data-group-id="2406217187-12">}</span><span class="w">
      </span><span class="p" data-group-id="2406217187-11">]</span><span class="w">
    </span><span class="k" data-group-id="2406217187-10">end</span><span class="w">
  </span><span class="k" data-group-id="2406217187-2">end</span><span class="w">
  
  </span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">PositionSensor</span><span class="w"> </span><span class="k" data-group-id="2406217187-15">do</span><span class="w">
    </span><span class="na">@behaviour</span><span class="w"> </span><span class="nc">Bardo.AgentManager.Sensor</span><span class="w">
    
    </span><span class="na">@impl</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">init</span><span class="p" data-group-id="2406217187-16">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">cortex_pid</span><span class="p">,</span><span class="w"> </span><span class="n">vl</span><span class="p">,</span><span class="w"> </span><span class="n">fanout</span><span class="p" data-group-id="2406217187-16">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-17">do</span><span class="w">
      </span><span class="p" data-group-id="2406217187-18">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2406217187-19">%{</span><span class="w">
        </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w">
        </span><span class="ss">sensor_type</span><span class="p">:</span><span class="w"> </span><span class="ss">:position</span><span class="p">,</span><span class="w">
        </span><span class="ss">fanout</span><span class="p">:</span><span class="w"> </span><span class="n">fanout</span><span class="p">,</span><span class="w">
        </span><span class="ss">cortex_pid</span><span class="p">:</span><span class="w"> </span><span class="n">cortex_pid</span><span class="p">,</span><span class="w">
        </span><span class="ss">vl</span><span class="p">:</span><span class="w"> </span><span class="n">vl</span><span class="w">
      </span><span class="p" data-group-id="2406217187-19">}</span><span class="p" data-group-id="2406217187-18">}</span><span class="w">
    </span><span class="k" data-group-id="2406217187-17">end</span><span class="w">
    
    </span><span class="na">@impl</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">sense</span><span class="p" data-group-id="2406217187-20">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p" data-group-id="2406217187-20">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-21">do</span><span class="w">
      </span><span class="c1"># Normalize position to range 0.0..1.0</span><span class="w">
      </span><span class="p" data-group-id="2406217187-22">{</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p" data-group-id="2406217187-22">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">.</span><span class="n">position</span><span class="w">
      </span><span class="p" data-group-id="2406217187-23">{</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p" data-group-id="2406217187-23">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">.</span><span class="n">grid_size</span><span class="w">
      
      </span><span class="n">signals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2406217187-24">[</span><span class="w">
        </span><span class="n">x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w">
        </span><span class="n">y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">height</span><span class="w">
      </span><span class="p" data-group-id="2406217187-24">]</span><span class="w">
      
      </span><span class="p" data-group-id="2406217187-25">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">signals</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="2406217187-25">}</span><span class="w">
    </span><span class="k" data-group-id="2406217187-21">end</span><span class="w">
  </span><span class="k" data-group-id="2406217187-15">end</span><span class="w">
  
  </span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">GoalSensor</span><span class="w"> </span><span class="k" data-group-id="2406217187-26">do</span><span class="w">
    </span><span class="na">@behaviour</span><span class="w"> </span><span class="nc">Bardo.AgentManager.Sensor</span><span class="w">
    
    </span><span class="na">@impl</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">init</span><span class="p" data-group-id="2406217187-27">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">cortex_pid</span><span class="p">,</span><span class="w"> </span><span class="n">vl</span><span class="p">,</span><span class="w"> </span><span class="n">fanout</span><span class="p" data-group-id="2406217187-27">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-28">do</span><span class="w">
      </span><span class="p" data-group-id="2406217187-29">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2406217187-30">%{</span><span class="w">
        </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w">
        </span><span class="ss">sensor_type</span><span class="p">:</span><span class="w"> </span><span class="ss">:goal</span><span class="p">,</span><span class="w">
        </span><span class="ss">fanout</span><span class="p">:</span><span class="w"> </span><span class="n">fanout</span><span class="p">,</span><span class="w">
        </span><span class="ss">cortex_pid</span><span class="p">:</span><span class="w"> </span><span class="n">cortex_pid</span><span class="p">,</span><span class="w">
        </span><span class="ss">vl</span><span class="p">:</span><span class="w"> </span><span class="n">vl</span><span class="w">
      </span><span class="p" data-group-id="2406217187-30">}</span><span class="p" data-group-id="2406217187-29">}</span><span class="w">
    </span><span class="k" data-group-id="2406217187-28">end</span><span class="w">
    
    </span><span class="na">@impl</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">sense</span><span class="p" data-group-id="2406217187-31">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p" data-group-id="2406217187-31">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-32">do</span><span class="w">
      </span><span class="c1"># Calculate direction to goal</span><span class="w">
      </span><span class="p" data-group-id="2406217187-33">{</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p" data-group-id="2406217187-33">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">.</span><span class="n">position</span><span class="w">
      </span><span class="p" data-group-id="2406217187-34">{</span><span class="n">goal_x</span><span class="p">,</span><span class="w"> </span><span class="n">goal_y</span><span class="p" data-group-id="2406217187-34">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">.</span><span class="n">goal</span><span class="w">
      
      </span><span class="c1"># Direction vector to goal</span><span class="w">
      </span><span class="n">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2406217187-35">(</span><span class="n">goal_x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p" data-group-id="2406217187-35">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">data</span><span class="o">.</span><span class="n">grid_size</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">element</span><span class="p" data-group-id="2406217187-36">(</span><span class="mi">0</span><span class="p" data-group-id="2406217187-36">)</span><span class="w">
      </span><span class="n">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2406217187-37">(</span><span class="n">goal_y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y</span><span class="p" data-group-id="2406217187-37">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">data</span><span class="o">.</span><span class="n">grid_size</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">element</span><span class="p" data-group-id="2406217187-38">(</span><span class="mi">1</span><span class="p" data-group-id="2406217187-38">)</span><span class="w">
      
      </span><span class="n">signals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2406217187-39">[</span><span class="n">dx</span><span class="p">,</span><span class="w"> </span><span class="n">dy</span><span class="p" data-group-id="2406217187-39">]</span><span class="w">
      
      </span><span class="p" data-group-id="2406217187-40">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">signals</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="2406217187-40">}</span><span class="w">
    </span><span class="k" data-group-id="2406217187-32">end</span><span class="w">
  </span><span class="k" data-group-id="2406217187-26">end</span><span class="w">
  
  </span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">MovementActuator</span><span class="w"> </span><span class="k" data-group-id="2406217187-41">do</span><span class="w">
    </span><span class="na">@behaviour</span><span class="w"> </span><span class="nc">Bardo.AgentManager.Actuator</span><span class="w">
    
    </span><span class="na">@impl</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">init</span><span class="p" data-group-id="2406217187-42">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">cortex_pid</span><span class="p">,</span><span class="w"> </span><span class="n">vl</span><span class="p">,</span><span class="w"> </span><span class="n">fanin</span><span class="p" data-group-id="2406217187-42">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-43">do</span><span class="w">
      </span><span class="p" data-group-id="2406217187-44">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2406217187-45">%{</span><span class="w">
        </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w">
        </span><span class="ss">actuator_type</span><span class="p">:</span><span class="w"> </span><span class="ss">:movement</span><span class="p">,</span><span class="w">
        </span><span class="ss">fanin</span><span class="p">:</span><span class="w"> </span><span class="n">fanin</span><span class="p">,</span><span class="w">
        </span><span class="ss">cortex_pid</span><span class="p">:</span><span class="w"> </span><span class="n">cortex_pid</span><span class="p">,</span><span class="w">
        </span><span class="ss">vl</span><span class="p">:</span><span class="w"> </span><span class="n">vl</span><span class="w">
      </span><span class="p" data-group-id="2406217187-45">}</span><span class="p" data-group-id="2406217187-44">}</span><span class="w">
    </span><span class="k" data-group-id="2406217187-43">end</span><span class="w">
    
    </span><span class="na">@impl</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">actuate</span><span class="p" data-group-id="2406217187-46">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2406217187-47">{</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">signals</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p" data-group-id="2406217187-47">}</span><span class="p" data-group-id="2406217187-46">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-48">do</span><span class="w">
      </span><span class="c1"># Get movement direction from neural network outputs</span><span class="w">
      </span><span class="p" data-group-id="2406217187-49">[</span><span class="n">up</span><span class="p">,</span><span class="w"> </span><span class="n">down</span><span class="p">,</span><span class="w"> </span><span class="n">left</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="p" data-group-id="2406217187-49">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">signals</span><span class="w">
      
      </span><span class="c1"># Choose the strongest output</span><span class="w">
      </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">zip</span><span class="p" data-group-id="2406217187-50">(</span><span class="p" data-group-id="2406217187-51">[</span><span class="ss">:up</span><span class="p">,</span><span class="w"> </span><span class="ss">:down</span><span class="p">,</span><span class="w"> </span><span class="ss">:left</span><span class="p">,</span><span class="w"> </span><span class="ss">:right</span><span class="p" data-group-id="2406217187-51">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2406217187-52">[</span><span class="n">up</span><span class="p">,</span><span class="w"> </span><span class="n">down</span><span class="p">,</span><span class="w"> </span><span class="n">left</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="p" data-group-id="2406217187-52">]</span><span class="p" data-group-id="2406217187-50">)</span><span class="w">
                  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">max_by</span><span class="p" data-group-id="2406217187-53">(</span><span class="k" data-group-id="2406217187-54">fn</span><span class="w"> </span><span class="p" data-group-id="2406217187-55">{</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p" data-group-id="2406217187-55">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k" data-group-id="2406217187-54">end</span><span class="p" data-group-id="2406217187-53">)</span><span class="w">
                  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">elem</span><span class="p" data-group-id="2406217187-56">(</span><span class="mi">0</span><span class="p" data-group-id="2406217187-56">)</span><span class="w">
      
      </span><span class="p" data-group-id="2406217187-57">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="2406217187-57">}</span><span class="w">
    </span><span class="k" data-group-id="2406217187-48">end</span><span class="w">
  </span><span class="k" data-group-id="2406217187-41">end</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Runs the grid world simulation.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">run</span><span class="w"> </span><span class="k" data-group-id="2406217187-58">do</span><span class="w">
    </span><span class="c1"># Start Bardo subsystems</span><span class="w">
    </span><span class="nc">Bardo</span><span class="o">.</span><span class="n">start</span><span class="p" data-group-id="2406217187-59">(</span><span class="p" data-group-id="2406217187-59">)</span><span class="w">
    
    </span><span class="c1"># Create a unique experiment ID</span><span class="w">
    </span><span class="n">experiment_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;grid_world_</span><span class="si" data-group-id="2406217187-60">#{</span><span class="nc">:os</span><span class="o">.</span><span class="n">system_time</span><span class="p" data-group-id="2406217187-61">(</span><span class="ss">:millisecond</span><span class="p" data-group-id="2406217187-61">)</span><span class="si" data-group-id="2406217187-60">}</span><span class="s">&quot;</span><span class="w">
    
    </span><span class="c1"># Create the experiment</span><span class="w">
    </span><span class="p" data-group-id="2406217187-62">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="c">_pid</span><span class="p" data-group-id="2406217187-62">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.ExperimentManager</span><span class="o">.</span><span class="n">new_experiment</span><span class="p" data-group-id="2406217187-63">(</span><span class="n">experiment_id</span><span class="p" data-group-id="2406217187-63">)</span><span class="w">
    
    </span><span class="c1"># Configure the experiment</span><span class="w">
    </span><span class="ss">:ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.ExperimentManager</span><span class="o">.</span><span class="n">configure</span><span class="p" data-group-id="2406217187-64">(</span><span class="n">experiment_id</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2406217187-65">%{</span><span class="w">
      </span><span class="ss">population_size</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
      </span><span class="ss">max_generations</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w">
      </span><span class="ss">mutation_rate</span><span class="p">:</span><span class="w"> </span><span class="mf">0.3</span><span class="p">,</span><span class="w">
      </span><span class="ss">fitness_goal</span><span class="p">:</span><span class="w"> </span><span class="mf">0.95</span><span class="w">  </span><span class="c1"># Stop when we reach this fitness (max is 1.0)</span><span class="w">
    </span><span class="p" data-group-id="2406217187-65">}</span><span class="p" data-group-id="2406217187-64">)</span><span class="w">
    
    </span><span class="c1"># Start the evolution with our fitness function</span><span class="w">
    </span><span class="ss">:ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.ExperimentManager</span><span class="o">.</span><span class="n">start_evaluation</span><span class="p" data-group-id="2406217187-66">(</span><span class="n">experiment_id</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">evaluate_navigation</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="2406217187-66">)</span><span class="w">
    
    </span><span class="c1"># Wait for the experiment to complete</span><span class="w">
    </span><span class="p" data-group-id="2406217187-67">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p" data-group-id="2406217187-67">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wait_for_completion</span><span class="p" data-group-id="2406217187-68">(</span><span class="n">experiment_id</span><span class="p" data-group-id="2406217187-68">)</span><span class="w">
    
    </span><span class="c1"># Get the best solution</span><span class="w">
    </span><span class="p" data-group-id="2406217187-69">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">champion</span><span class="p" data-group-id="2406217187-69">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.ExperimentManager</span><span class="o">.</span><span class="n">get_best_solution</span><span class="p" data-group-id="2406217187-70">(</span><span class="n">experiment_id</span><span class="p" data-group-id="2406217187-70">)</span><span class="w">
    
    </span><span class="c1"># Test the champion</span><span class="w">
    </span><span class="n">test_champion</span><span class="p" data-group-id="2406217187-71">(</span><span class="n">champion</span><span class="p" data-group-id="2406217187-71">)</span><span class="w">
    
    </span><span class="c1"># Return the champion</span><span class="w">
    </span><span class="n">champion</span><span class="w">
  </span><span class="k" data-group-id="2406217187-58">end</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Evaluates a genotype on the grid world navigation task.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">evaluate_navigation</span><span class="p" data-group-id="2406217187-72">(</span><span class="n">genotype</span><span class="p" data-group-id="2406217187-72">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-73">do</span><span class="w">
    </span><span class="c1"># World parameters</span><span class="w">
    </span><span class="n">grid_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2406217187-74">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p" data-group-id="2406217187-74">}</span><span class="w">
    </span><span class="n">goal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2406217187-75">{</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p" data-group-id="2406217187-75">}</span><span class="w">
    </span><span class="n">max_steps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="w">
    
    </span><span class="c1"># Convert genotype to neural network</span><span class="w">
    </span><span class="n">nn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.AgentManager.Cortex</span><span class="o">.</span><span class="n">from_genotype</span><span class="p" data-group-id="2406217187-76">(</span><span class="n">genotype</span><span class="p">,</span><span class="w"> </span><span class="bp">__MODULE__</span><span class="o">.</span><span class="nc">Morphology</span><span class="p" data-group-id="2406217187-76">)</span><span class="w">
    
    </span><span class="c1"># Add sensors and actuators</span><span class="w">
    </span><span class="n">nn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.AgentManager.Cortex</span><span class="o">.</span><span class="n">add_sensor</span><span class="p" data-group-id="2406217187-77">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="bp">__MODULE__</span><span class="o">.</span><span class="nc">PositionSensor</span><span class="p" data-group-id="2406217187-77">)</span><span class="w">
    </span><span class="n">nn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.AgentManager.Cortex</span><span class="o">.</span><span class="n">add_sensor</span><span class="p" data-group-id="2406217187-78">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="bp">__MODULE__</span><span class="o">.</span><span class="nc">GoalSensor</span><span class="p" data-group-id="2406217187-78">)</span><span class="w">
    </span><span class="n">nn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.AgentManager.Cortex</span><span class="o">.</span><span class="n">add_actuator</span><span class="p" data-group-id="2406217187-79">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="bp">__MODULE__</span><span class="o">.</span><span class="nc">MovementActuator</span><span class="p" data-group-id="2406217187-79">)</span><span class="w">
    
    </span><span class="c1"># Run simulation</span><span class="w">
    </span><span class="n">simulate_agent</span><span class="p" data-group-id="2406217187-80">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2406217187-81">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2406217187-81">}</span><span class="p">,</span><span class="w"> </span><span class="n">goal</span><span class="p">,</span><span class="w"> </span><span class="n">grid_size</span><span class="p">,</span><span class="w"> </span><span class="n">max_steps</span><span class="p" data-group-id="2406217187-80">)</span><span class="w">
  </span><span class="k" data-group-id="2406217187-73">end</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Simulates an agent navigating the grid world.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">simulate_agent</span><span class="p" data-group-id="2406217187-82">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">goal</span><span class="p">,</span><span class="w"> </span><span class="n">grid_size</span><span class="p">,</span><span class="w"> </span><span class="n">steps_left</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">\\</span><span class="w"> </span><span class="p" data-group-id="2406217187-83">[</span><span class="p" data-group-id="2406217187-83">]</span><span class="p" data-group-id="2406217187-82">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-84">do</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">goal</span><span class="w"> </span><span class="k" data-group-id="2406217187-85">do</span><span class="w">
      </span><span class="c1"># Reached goal, calculate fitness based on path length</span><span class="w">
      </span><span class="n">path_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p" data-group-id="2406217187-86">(</span><span class="n">path</span><span class="p" data-group-id="2406217187-86">)</span><span class="w">
      </span><span class="n">optimal_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abs</span><span class="p" data-group-id="2406217187-87">(</span><span class="n">elem</span><span class="p" data-group-id="2406217187-88">(</span><span class="n">goal</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2406217187-88">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2406217187-87">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">abs</span><span class="p" data-group-id="2406217187-89">(</span><span class="n">elem</span><span class="p" data-group-id="2406217187-90">(</span><span class="n">goal</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="2406217187-90">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2406217187-89">)</span><span class="w">
      </span><span class="n">efficiency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">optimal_length</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">path_length</span><span class="w">
      
      </span><span class="c1"># Return fitness (1.0 for optimal path)</span><span class="w">
      </span><span class="mf">1.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">efficiency</span><span class="w">
    </span><span class="k" data-group-id="2406217187-85">else</span><span class="w">
      </span><span class="k">if</span><span class="w"> </span><span class="n">steps_left</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="2406217187-91">do</span><span class="w">
        </span><span class="c1"># Out of steps, calculate fitness based on distance to goal</span><span class="w">
        </span><span class="p" data-group-id="2406217187-92">{</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p" data-group-id="2406217187-92">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position</span><span class="w">
        </span><span class="p" data-group-id="2406217187-93">{</span><span class="n">goal_x</span><span class="p">,</span><span class="w"> </span><span class="n">goal_y</span><span class="p" data-group-id="2406217187-93">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">goal</span><span class="w">
        </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">:math</span><span class="o">.</span><span class="n">sqrt</span><span class="p" data-group-id="2406217187-94">(</span><span class="nc">:math</span><span class="o">.</span><span class="n">pow</span><span class="p" data-group-id="2406217187-95">(</span><span class="n">goal_x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2406217187-95">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nc">:math</span><span class="o">.</span><span class="n">pow</span><span class="p" data-group-id="2406217187-96">(</span><span class="n">goal_y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2406217187-96">)</span><span class="p" data-group-id="2406217187-94">)</span><span class="w">
        </span><span class="n">max_distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">:math</span><span class="o">.</span><span class="n">sqrt</span><span class="p" data-group-id="2406217187-97">(</span><span class="nc">:math</span><span class="o">.</span><span class="n">pow</span><span class="p" data-group-id="2406217187-98">(</span><span class="n">goal_x</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2406217187-98">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nc">:math</span><span class="o">.</span><span class="n">pow</span><span class="p" data-group-id="2406217187-99">(</span><span class="n">goal_y</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="2406217187-99">)</span><span class="p" data-group-id="2406217187-97">)</span><span class="w">
        
        </span><span class="c1"># Return fitness (closer to goal is better)</span><span class="w">
        </span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p" data-group-id="2406217187-100">(</span><span class="n">distance</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">max_distance</span><span class="p" data-group-id="2406217187-100">)</span><span class="w">
      </span><span class="k" data-group-id="2406217187-91">else</span><span class="w">
        </span><span class="c1"># Sense environment</span><span class="w">
        </span><span class="n">sensor_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2406217187-101">%{</span><span class="w">
          </span><span class="ss">position</span><span class="p">:</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w">
          </span><span class="ss">goal</span><span class="p">:</span><span class="w"> </span><span class="n">goal</span><span class="p">,</span><span class="w">
          </span><span class="ss">grid_size</span><span class="p">:</span><span class="w"> </span><span class="n">grid_size</span><span class="w">
        </span><span class="p" data-group-id="2406217187-101">}</span><span class="w">
        
        </span><span class="c1"># Get action from neural network</span><span class="w">
        </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activate_agent</span><span class="p" data-group-id="2406217187-102">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="n">sensor_data</span><span class="p" data-group-id="2406217187-102">)</span><span class="w">
        
        </span><span class="c1"># Update position based on action</span><span class="w">
        </span><span class="n">new_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update_position</span><span class="p" data-group-id="2406217187-103">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">grid_size</span><span class="p" data-group-id="2406217187-103">)</span><span class="w">
        
        </span><span class="c1"># Continue simulation</span><span class="w">
        </span><span class="n">simulate_agent</span><span class="p" data-group-id="2406217187-104">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="n">new_position</span><span class="p">,</span><span class="w"> </span><span class="n">goal</span><span class="p">,</span><span class="w"> </span><span class="n">grid_size</span><span class="p">,</span><span class="w"> </span><span class="n">steps_left</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2406217187-105">[</span><span class="n">new_position</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">path</span><span class="p" data-group-id="2406217187-105">]</span><span class="p" data-group-id="2406217187-104">)</span><span class="w">
      </span><span class="k" data-group-id="2406217187-91">end</span><span class="w">
    </span><span class="k" data-group-id="2406217187-85">end</span><span class="w">
  </span><span class="k" data-group-id="2406217187-84">end</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Activates the agent&#39;s neural network to get an action.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">activate_agent</span><span class="p" data-group-id="2406217187-106">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="n">sensor_data</span><span class="p" data-group-id="2406217187-106">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-107">do</span><span class="w">
    </span><span class="c1"># Prepare input for position sensor</span><span class="w">
    </span><span class="n">position_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2406217187-108">%{</span><span class="w">
      </span><span class="ss">position</span><span class="p">:</span><span class="w"> </span><span class="n">sensor_data</span><span class="o">.</span><span class="n">position</span><span class="p">,</span><span class="w">
      </span><span class="ss">grid_size</span><span class="p">:</span><span class="w"> </span><span class="n">sensor_data</span><span class="o">.</span><span class="n">grid_size</span><span class="w">
    </span><span class="p" data-group-id="2406217187-108">}</span><span class="w">
    
    </span><span class="c1"># Prepare input for goal sensor</span><span class="w">
    </span><span class="n">goal_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2406217187-109">%{</span><span class="w">
      </span><span class="ss">position</span><span class="p">:</span><span class="w"> </span><span class="n">sensor_data</span><span class="o">.</span><span class="n">position</span><span class="p">,</span><span class="w">
      </span><span class="ss">goal</span><span class="p">:</span><span class="w"> </span><span class="n">sensor_data</span><span class="o">.</span><span class="n">goal</span><span class="p">,</span><span class="w">
      </span><span class="ss">grid_size</span><span class="p">:</span><span class="w"> </span><span class="n">sensor_data</span><span class="o">.</span><span class="n">grid_size</span><span class="w">
    </span><span class="p" data-group-id="2406217187-109">}</span><span class="w">
    
    </span><span class="c1"># Activate neural network</span><span class="w">
    </span><span class="nc">Bardo.AgentManager.Cortex</span><span class="o">.</span><span class="n">activate</span><span class="p" data-group-id="2406217187-110">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2406217187-111">%{</span><span class="w">
      </span><span class="ss">position_sensor</span><span class="p">:</span><span class="w"> </span><span class="n">position_input</span><span class="p">,</span><span class="w">
      </span><span class="ss">goal_sensor</span><span class="p">:</span><span class="w"> </span><span class="n">goal_input</span><span class="w">
    </span><span class="p" data-group-id="2406217187-111">}</span><span class="p" data-group-id="2406217187-110">)</span><span class="w">
  </span><span class="k" data-group-id="2406217187-107">end</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Updates the agent&#39;s position based on an action.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">update_position</span><span class="p" data-group-id="2406217187-112">(</span><span class="p" data-group-id="2406217187-113">{</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p" data-group-id="2406217187-113">}</span><span class="p">,</span><span class="w"> </span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2406217187-114">{</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p" data-group-id="2406217187-114">}</span><span class="p" data-group-id="2406217187-112">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-115">do</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="k" data-group-id="2406217187-116">do</span><span class="w">
      </span><span class="ss">:up</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="2406217187-117">{</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p" data-group-id="2406217187-118">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="2406217187-118">)</span><span class="p" data-group-id="2406217187-117">}</span><span class="w">
      </span><span class="ss">:down</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="2406217187-119">{</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p" data-group-id="2406217187-120">(</span><span class="n">height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="2406217187-120">)</span><span class="p" data-group-id="2406217187-119">}</span><span class="w">
      </span><span class="ss">:left</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="2406217187-121">{</span><span class="n">max</span><span class="p" data-group-id="2406217187-122">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="2406217187-122">)</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p" data-group-id="2406217187-121">}</span><span class="w">
      </span><span class="ss">:right</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="2406217187-123">{</span><span class="n">min</span><span class="p" data-group-id="2406217187-124">(</span><span class="n">width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="2406217187-124">)</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p" data-group-id="2406217187-123">}</span><span class="w">
    </span><span class="k" data-group-id="2406217187-116">end</span><span class="w">
  </span><span class="k" data-group-id="2406217187-115">end</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Tests a champion genotype on the grid world navigation task.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">test_champion</span><span class="p" data-group-id="2406217187-125">(</span><span class="n">genotype</span><span class="p" data-group-id="2406217187-125">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-126">do</span><span class="w">
    </span><span class="c1"># World parameters</span><span class="w">
    </span><span class="n">grid_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2406217187-127">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p" data-group-id="2406217187-127">}</span><span class="w">
    </span><span class="n">goal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2406217187-128">{</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p" data-group-id="2406217187-128">}</span><span class="w">
    </span><span class="n">max_steps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="w">
    
    </span><span class="c1"># Convert genotype to neural network</span><span class="w">
    </span><span class="n">nn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.AgentManager.Cortex</span><span class="o">.</span><span class="n">from_genotype</span><span class="p" data-group-id="2406217187-129">(</span><span class="n">genotype</span><span class="p">,</span><span class="w"> </span><span class="bp">__MODULE__</span><span class="o">.</span><span class="nc">Morphology</span><span class="p" data-group-id="2406217187-129">)</span><span class="w">
    
    </span><span class="c1"># Add sensors and actuators</span><span class="w">
    </span><span class="n">nn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.AgentManager.Cortex</span><span class="o">.</span><span class="n">add_sensor</span><span class="p" data-group-id="2406217187-130">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="bp">__MODULE__</span><span class="o">.</span><span class="nc">PositionSensor</span><span class="p" data-group-id="2406217187-130">)</span><span class="w">
    </span><span class="n">nn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.AgentManager.Cortex</span><span class="o">.</span><span class="n">add_sensor</span><span class="p" data-group-id="2406217187-131">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="bp">__MODULE__</span><span class="o">.</span><span class="nc">GoalSensor</span><span class="p" data-group-id="2406217187-131">)</span><span class="w">
    </span><span class="n">nn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.AgentManager.Cortex</span><span class="o">.</span><span class="n">add_actuator</span><span class="p" data-group-id="2406217187-132">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="bp">__MODULE__</span><span class="o">.</span><span class="nc">MovementActuator</span><span class="p" data-group-id="2406217187-132">)</span><span class="w">
    
    </span><span class="c1"># Run simulation with visualization</span><span class="w">
    </span><span class="n">visualize_agent</span><span class="p" data-group-id="2406217187-133">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2406217187-134">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2406217187-134">}</span><span class="p">,</span><span class="w"> </span><span class="n">goal</span><span class="p">,</span><span class="w"> </span><span class="n">grid_size</span><span class="p">,</span><span class="w"> </span><span class="n">max_steps</span><span class="p" data-group-id="2406217187-133">)</span><span class="w">
  </span><span class="k" data-group-id="2406217187-126">end</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Visualizes an agent navigating the grid world.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">visualize_agent</span><span class="p" data-group-id="2406217187-135">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">goal</span><span class="p">,</span><span class="w"> </span><span class="n">grid_size</span><span class="p">,</span><span class="w"> </span><span class="n">steps_left</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">\\</span><span class="w"> </span><span class="p" data-group-id="2406217187-136">[</span><span class="p" data-group-id="2406217187-136">]</span><span class="p" data-group-id="2406217187-135">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-137">do</span><span class="w">
    </span><span class="c1"># Print grid</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="2406217187-138">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Grid World Navigation:&quot;</span><span class="p" data-group-id="2406217187-138">)</span><span class="w">
    </span><span class="n">print_grid</span><span class="p" data-group-id="2406217187-139">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">goal</span><span class="p">,</span><span class="w"> </span><span class="n">grid_size</span><span class="p" data-group-id="2406217187-139">)</span><span class="w">
    
    </span><span class="k">if</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">goal</span><span class="w"> </span><span class="k" data-group-id="2406217187-140">do</span><span class="w">
      </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="2406217187-141">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Goal reached in </span><span class="si" data-group-id="2406217187-142">#{</span><span class="n">length</span><span class="p" data-group-id="2406217187-143">(</span><span class="n">path</span><span class="p" data-group-id="2406217187-143">)</span><span class="si" data-group-id="2406217187-142">}</span><span class="s"> steps!&quot;</span><span class="p" data-group-id="2406217187-141">)</span><span class="w">
      </span><span class="n">path</span><span class="w">
    </span><span class="k" data-group-id="2406217187-140">else</span><span class="w">
      </span><span class="k">if</span><span class="w"> </span><span class="n">steps_left</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="2406217187-144">do</span><span class="w">
        </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="2406217187-145">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Failed to reach goal within step limit.&quot;</span><span class="p" data-group-id="2406217187-145">)</span><span class="w">
        </span><span class="n">path</span><span class="w">
      </span><span class="k" data-group-id="2406217187-144">else</span><span class="w">
        </span><span class="c1"># Sense environment</span><span class="w">
        </span><span class="n">sensor_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2406217187-146">%{</span><span class="w">
          </span><span class="ss">position</span><span class="p">:</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w">
          </span><span class="ss">goal</span><span class="p">:</span><span class="w"> </span><span class="n">goal</span><span class="p">,</span><span class="w">
          </span><span class="ss">grid_size</span><span class="p">:</span><span class="w"> </span><span class="n">grid_size</span><span class="w">
        </span><span class="p" data-group-id="2406217187-146">}</span><span class="w">
        
        </span><span class="c1"># Get action from neural network</span><span class="w">
        </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activate_agent</span><span class="p" data-group-id="2406217187-147">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="n">sensor_data</span><span class="p" data-group-id="2406217187-147">)</span><span class="w">
        
        </span><span class="c1"># Update position based on action</span><span class="w">
        </span><span class="n">new_position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update_position</span><span class="p" data-group-id="2406217187-148">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">grid_size</span><span class="p" data-group-id="2406217187-148">)</span><span class="w">
        </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="2406217187-149">(</span><span class="s">&quot;Action: </span><span class="si" data-group-id="2406217187-150">#{</span><span class="n">action</span><span class="si" data-group-id="2406217187-150">}</span><span class="s">&quot;</span><span class="p" data-group-id="2406217187-149">)</span><span class="w">
        
        </span><span class="c1"># Continue simulation</span><span class="w">
        </span><span class="nc">:timer</span><span class="o">.</span><span class="n">sleep</span><span class="p" data-group-id="2406217187-151">(</span><span class="mi">200</span><span class="p" data-group-id="2406217187-151">)</span><span class="w">  </span><span class="c1"># Slow down visualization</span><span class="w">
        </span><span class="n">visualize_agent</span><span class="p" data-group-id="2406217187-152">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="n">new_position</span><span class="p">,</span><span class="w"> </span><span class="n">goal</span><span class="p">,</span><span class="w"> </span><span class="n">grid_size</span><span class="p">,</span><span class="w"> </span><span class="n">steps_left</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2406217187-153">[</span><span class="n">new_position</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">path</span><span class="p" data-group-id="2406217187-153">]</span><span class="p" data-group-id="2406217187-152">)</span><span class="w">
      </span><span class="k" data-group-id="2406217187-144">end</span><span class="w">
    </span><span class="k" data-group-id="2406217187-140">end</span><span class="w">
  </span><span class="k" data-group-id="2406217187-137">end</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Prints the grid world.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">print_grid</span><span class="p" data-group-id="2406217187-154">(</span><span class="n">agent_pos</span><span class="p">,</span><span class="w"> </span><span class="n">goal_pos</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2406217187-155">{</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p" data-group-id="2406217187-155">}</span><span class="p" data-group-id="2406217187-154">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-156">do</span><span class="w">
    </span><span class="k">for</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="p" data-group-id="2406217187-157">(</span><span class="n">height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="2406217187-157">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-158">do</span><span class="w">
      </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="p" data-group-id="2406217187-159">(</span><span class="n">width</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="2406217187-159">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-160">do</span><span class="w">
        </span><span class="k">cond</span><span class="w"> </span><span class="k" data-group-id="2406217187-161">do</span><span class="w">
          </span><span class="p" data-group-id="2406217187-162">{</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p" data-group-id="2406217187-162">}</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">agent_pos</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="w">
          </span><span class="p" data-group-id="2406217187-163">{</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p" data-group-id="2406217187-163">}</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">goal_pos</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;G&quot;</span><span class="w">
          </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w">
        </span><span class="k" data-group-id="2406217187-161">end</span><span class="w">
      </span><span class="k" data-group-id="2406217187-160">end</span><span class="w">
      </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="2406217187-164">(</span><span class="nc">Enum</span><span class="o">.</span><span class="n">join</span><span class="p" data-group-id="2406217187-165">(</span><span class="n">line</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p" data-group-id="2406217187-165">)</span><span class="p" data-group-id="2406217187-164">)</span><span class="w">
    </span><span class="k" data-group-id="2406217187-158">end</span><span class="w">
  </span><span class="k" data-group-id="2406217187-156">end</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Waits for an experiment to complete.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">wait_for_completion</span><span class="p" data-group-id="2406217187-166">(</span><span class="n">experiment_id</span><span class="p">,</span><span class="w"> </span><span class="n">max_attempts</span><span class="w"> </span><span class="o">\\</span><span class="w"> </span><span class="mi">100</span><span class="p" data-group-id="2406217187-166">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-167">do</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="n">max_attempts</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="2406217187-168">do</span><span class="w">
      </span><span class="p" data-group-id="2406217187-169">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="ss">:timeout</span><span class="p" data-group-id="2406217187-169">}</span><span class="w">
    </span><span class="k" data-group-id="2406217187-168">else</span><span class="w">
      </span><span class="k">case</span><span class="w"> </span><span class="nc">Bardo.ExperimentManager</span><span class="o">.</span><span class="n">status</span><span class="p" data-group-id="2406217187-170">(</span><span class="n">experiment_id</span><span class="p" data-group-id="2406217187-170">)</span><span class="w"> </span><span class="k" data-group-id="2406217187-171">do</span><span class="w">
        </span><span class="p" data-group-id="2406217187-172">{</span><span class="ss">:complete</span><span class="p">,</span><span class="w"> </span><span class="n">experiment</span><span class="p" data-group-id="2406217187-172">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
          </span><span class="p" data-group-id="2406217187-173">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">experiment</span><span class="p" data-group-id="2406217187-173">}</span><span class="w">
        
        </span><span class="p" data-group-id="2406217187-174">{</span><span class="ss">:in_progress</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p" data-group-id="2406217187-174">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
          </span><span class="nc">:timer</span><span class="o">.</span><span class="n">sleep</span><span class="p" data-group-id="2406217187-175">(</span><span class="mi">100</span><span class="p" data-group-id="2406217187-175">)</span><span class="w">
          </span><span class="n">wait_for_completion</span><span class="p" data-group-id="2406217187-176">(</span><span class="n">experiment_id</span><span class="p">,</span><span class="w"> </span><span class="n">max_attempts</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="2406217187-176">)</span><span class="w">
        
        </span><span class="n">other</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
          </span><span class="p" data-group-id="2406217187-177">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">other</span><span class="p" data-group-id="2406217187-177">}</span><span class="w">
      </span><span class="k" data-group-id="2406217187-171">end</span><span class="w">
    </span><span class="k" data-group-id="2406217187-168">end</span><span class="w">
  </span><span class="k" data-group-id="2406217187-167">end</span><span class="w">
</span><span class="k" data-group-id="2406217187-1">end</span></code></pre><h3 id="3-2-running-the-grid-world-example" class="section-heading"><a href="#3-2-running-the-grid-world-example" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">3.2 Running the Grid World Example</span></h3><p>Run your grid world navigation example:</p><pre><code class="makeup elixir" translate="no"><span class="gp unselectable">iex&gt; </span><span class="nc">MyApp.GridWorld</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="3040282290-1">(</span><span class="p" data-group-id="3040282290-1">)</span></code></pre><h2 id="4-saving-and-loading-models" class="section-heading"><a href="#4-saving-and-loading-models" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">4. Saving and Loading Models</span></h2><p>Once you've evolved a successful neural network, you'll want to save it for later use.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">MyApp.ModelManager</span><span class="w"> </span><span class="k" data-group-id="6702925487-1">do</span><span class="w">
  </span><span class="na">@moduledoc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Utilities for saving and loading evolved models.
  &quot;&quot;&quot;</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Saves a champion genotype to file.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">save_champion</span><span class="p" data-group-id="6702925487-2">(</span><span class="n">genotype</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p" data-group-id="6702925487-2">)</span><span class="w"> </span><span class="k" data-group-id="6702925487-3">do</span><span class="w">
    </span><span class="nc">Bardo.Persistence</span><span class="o">.</span><span class="n">save</span><span class="p" data-group-id="6702925487-4">(</span><span class="n">genotype</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p" data-group-id="6702925487-4">)</span><span class="w">
  </span><span class="k" data-group-id="6702925487-3">end</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Loads a champion genotype from file.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">load_champion</span><span class="p" data-group-id="6702925487-5">(</span><span class="n">filename</span><span class="p" data-group-id="6702925487-5">)</span><span class="w"> </span><span class="k" data-group-id="6702925487-6">do</span><span class="w">
    </span><span class="nc">Bardo.Persistence</span><span class="o">.</span><span class="n">load</span><span class="p" data-group-id="6702925487-7">(</span><span class="n">filename</span><span class="p" data-group-id="6702925487-7">)</span><span class="w">
  </span><span class="k" data-group-id="6702925487-6">end</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Creates a neural network from a genotype file.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">create_network_from_file</span><span class="p" data-group-id="6702925487-8">(</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">morphology</span><span class="w"> </span><span class="o">\\</span><span class="w"> </span><span class="no">nil</span><span class="p" data-group-id="6702925487-8">)</span><span class="w"> </span><span class="k" data-group-id="6702925487-9">do</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">load_champion</span><span class="p" data-group-id="6702925487-10">(</span><span class="n">filename</span><span class="p" data-group-id="6702925487-10">)</span><span class="w"> </span><span class="k" data-group-id="6702925487-11">do</span><span class="w">
      </span><span class="p" data-group-id="6702925487-12">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">genotype</span><span class="p" data-group-id="6702925487-12">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">nn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">morphology</span><span class="w"> </span><span class="k" data-group-id="6702925487-13">do</span><span class="w">
          </span><span class="nc">Bardo.AgentManager.Cortex</span><span class="o">.</span><span class="n">from_genotype</span><span class="p" data-group-id="6702925487-14">(</span><span class="n">genotype</span><span class="p">,</span><span class="w"> </span><span class="n">morphology</span><span class="p" data-group-id="6702925487-14">)</span><span class="w">
        </span><span class="k" data-group-id="6702925487-13">else</span><span class="w">
          </span><span class="nc">Bardo.AgentManager.Cortex</span><span class="o">.</span><span class="n">from_genotype</span><span class="p" data-group-id="6702925487-15">(</span><span class="n">genotype</span><span class="p" data-group-id="6702925487-15">)</span><span class="w">
        </span><span class="k" data-group-id="6702925487-13">end</span><span class="w">
        
        </span><span class="p" data-group-id="6702925487-16">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">nn</span><span class="p" data-group-id="6702925487-16">}</span><span class="w">
        
      </span><span class="p" data-group-id="6702925487-17">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p" data-group-id="6702925487-17">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="p" data-group-id="6702925487-18">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p" data-group-id="6702925487-18">}</span><span class="w">
    </span><span class="k" data-group-id="6702925487-11">end</span><span class="w">
  </span><span class="k" data-group-id="6702925487-9">end</span><span class="w">
  
  </span><span class="na">@doc</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
  Runs inference with a saved model.
  &quot;&quot;&quot;</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">run_inference</span><span class="p" data-group-id="6702925487-19">(</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">morphology</span><span class="w"> </span><span class="o">\\</span><span class="w"> </span><span class="no">nil</span><span class="p" data-group-id="6702925487-19">)</span><span class="w"> </span><span class="k" data-group-id="6702925487-20">do</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">create_network_from_file</span><span class="p" data-group-id="6702925487-21">(</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">morphology</span><span class="p" data-group-id="6702925487-21">)</span><span class="w"> </span><span class="k" data-group-id="6702925487-22">do</span><span class="w">
      </span><span class="p" data-group-id="6702925487-23">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">nn</span><span class="p" data-group-id="6702925487-23">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Bardo.AgentManager.Cortex</span><span class="o">.</span><span class="n">activate</span><span class="p" data-group-id="6702925487-24">(</span><span class="n">nn</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p" data-group-id="6702925487-24">)</span><span class="w">
        </span><span class="p" data-group-id="6702925487-25">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p" data-group-id="6702925487-25">}</span><span class="w">
        
      </span><span class="p" data-group-id="6702925487-26">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p" data-group-id="6702925487-26">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="p" data-group-id="6702925487-27">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p" data-group-id="6702925487-27">}</span><span class="w">
    </span><span class="k" data-group-id="6702925487-22">end</span><span class="w">
  </span><span class="k" data-group-id="6702925487-20">end</span><span class="w">
</span><span class="k" data-group-id="6702925487-1">end</span></code></pre><h2 id="5-integration-with-phoenix" class="section-heading"><a href="#5-integration-with-phoenix" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">5. Integration with Phoenix</span></h2><p>If you're building a web application with Phoenix, you can use Bardo for tasks like recommendation systems or intelligent agents.</p><p>Here's a simple example of a Phoenix controller that uses a pre-trained Bardo model:</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">MyAppWeb.RecommendationController</span><span class="w"> </span><span class="k" data-group-id="6096256863-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">MyAppWeb</span><span class="p">,</span><span class="w"> </span><span class="ss">:controller</span><span class="w">
  
  </span><span class="na">@model_path</span><span class="w"> </span><span class="s">&quot;priv/models/recommendation_model.gen&quot;</span><span class="w">
  
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">index</span><span class="p" data-group-id="6096256863-2">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6096256863-3">%{</span><span class="s">&quot;user_id&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="n">user_id</span><span class="p" data-group-id="6096256863-3">}</span><span class="p" data-group-id="6096256863-2">)</span><span class="w"> </span><span class="k" data-group-id="6096256863-4">do</span><span class="w">
    </span><span class="c1"># Get user features</span><span class="w">
    </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MyApp.Accounts</span><span class="o">.</span><span class="n">get_user!</span><span class="p" data-group-id="6096256863-5">(</span><span class="n">user_id</span><span class="p" data-group-id="6096256863-5">)</span><span class="w">
    </span><span class="n">user_features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extract_user_features</span><span class="p" data-group-id="6096256863-6">(</span><span class="n">user</span><span class="p" data-group-id="6096256863-6">)</span><span class="w">
    
    </span><span class="c1"># Get recommendations using Bardo model</span><span class="w">
    </span><span class="p" data-group-id="6096256863-7">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">recommendations</span><span class="p" data-group-id="6096256863-7">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_recommendations</span><span class="p" data-group-id="6096256863-8">(</span><span class="n">user_features</span><span class="p" data-group-id="6096256863-8">)</span><span class="w">
    
    </span><span class="c1"># Render recommendations</span><span class="w">
    </span><span class="n">render</span><span class="p" data-group-id="6096256863-9">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;index.html&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">recommendations</span><span class="p">:</span><span class="w"> </span><span class="n">recommendations</span><span class="p" data-group-id="6096256863-9">)</span><span class="w">
  </span><span class="k" data-group-id="6096256863-4">end</span><span class="w">
  
  </span><span class="kd">defp</span><span class="w"> </span><span class="nf">extract_user_features</span><span class="p" data-group-id="6096256863-10">(</span><span class="n">user</span><span class="p" data-group-id="6096256863-10">)</span><span class="w"> </span><span class="k" data-group-id="6096256863-11">do</span><span class="w">
    </span><span class="c1"># Convert user data to neural network input</span><span class="w">
    </span><span class="c1"># ...</span><span class="w">
    </span><span class="n">features</span><span class="w">
  </span><span class="k" data-group-id="6096256863-11">end</span><span class="w">
  
  </span><span class="kd">defp</span><span class="w"> </span><span class="nf">get_recommendations</span><span class="p" data-group-id="6096256863-12">(</span><span class="n">user_features</span><span class="p" data-group-id="6096256863-12">)</span><span class="w"> </span><span class="k" data-group-id="6096256863-13">do</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="nc">MyApp.ModelManager</span><span class="o">.</span><span class="n">run_inference</span><span class="p" data-group-id="6096256863-14">(</span><span class="na">@model_path</span><span class="p">,</span><span class="w"> </span><span class="n">user_features</span><span class="p" data-group-id="6096256863-14">)</span><span class="w"> </span><span class="k" data-group-id="6096256863-15">do</span><span class="w">
      </span><span class="p" data-group-id="6096256863-16">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p" data-group-id="6096256863-16">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="c1"># Convert neural network output to product recommendations</span><span class="w">
        </span><span class="n">recommendations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">convert_to_recommendations</span><span class="p" data-group-id="6096256863-17">(</span><span class="n">output</span><span class="p" data-group-id="6096256863-17">)</span><span class="w">
        </span><span class="p" data-group-id="6096256863-18">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">recommendations</span><span class="p" data-group-id="6096256863-18">}</span><span class="w">
        
      </span><span class="p" data-group-id="6096256863-19">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p" data-group-id="6096256863-19">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="p" data-group-id="6096256863-20">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p" data-group-id="6096256863-20">}</span><span class="w">
    </span><span class="k" data-group-id="6096256863-15">end</span><span class="w">
  </span><span class="k" data-group-id="6096256863-13">end</span><span class="w">
  
  </span><span class="kd">defp</span><span class="w"> </span><span class="nf">convert_to_recommendations</span><span class="p" data-group-id="6096256863-21">(</span><span class="n">neural_output</span><span class="p" data-group-id="6096256863-21">)</span><span class="w"> </span><span class="k" data-group-id="6096256863-22">do</span><span class="w">
    </span><span class="c1"># Convert neural network output to product IDs</span><span class="w">
    </span><span class="c1"># ...</span><span class="w">
    </span><span class="n">recommendations</span><span class="w">
  </span><span class="k" data-group-id="6096256863-22">end</span><span class="w">
</span><span class="k" data-group-id="6096256863-1">end</span></code></pre><h2 id="6-best-practices" class="section-heading"><a href="#6-best-practices" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">6. Best Practices</span></h2><p>When using Bardo in production applications, follow these best practices:</p><ol><li><p><strong>Pre-train your models</strong>: Don't run evolution in production. Pre-train your models and deploy only the inference code.</p></li><li><p><strong>Error handling</strong>: Always handle errors from Bardo functions, especially when loading models or running inference.</p></li><li><p><strong>Input validation</strong>: Validate and normalize inputs before passing them to neural networks.</p></li><li><p><strong>Resource management</strong>: Be mindful of memory usage, especially with large neural networks.</p></li><li><p><strong>Monitoring</strong>: Add monitoring to track model performance and inference time in production.</p></li><li><p><strong>Fallbacks</strong>: Have fallback logic when neural networks fail or produce unexpected results.</p></li><li><p><strong>Version control</strong>: Keep track of your model versions and their corresponding training data.</p></li></ol><h2 id="7-advanced-topics" class="section-heading"><a href="#7-advanced-topics" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i></a><span class="text">7. Advanced Topics</span></h2><p>For more advanced usage of Bardo, consult the following resources:</p><ul><li><a href="api_reference.html">API Reference</a>: Comprehensive API documentation</li><li><a href="advanced.html">Advanced Features</a>: Information on advanced features like substrate encoding</li><li><a href="examples.html">Examples</a>: More example implementations</li></ul>

</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="readme.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Bardo
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="quickstart.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Bardo Quickstart Guide
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/bardo/0.1.0" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/bardo/0.1.0">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/bardo/0.1.0/show/docs/library_tutorial.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Bardo.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.38.0) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
